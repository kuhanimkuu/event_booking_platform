{% extends 'base.html' %}
{% block title %}{{ event.title }}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto mt-10 flex flex-col md:flex-row gap-6 px-4">
    
    <!-- Sidebar: Other Events -->
    <aside class="w-full md:w-1/3 bg-gray-50 p-5 rounded-2xl shadow-md h-[90vh] overflow-y-auto">
        <form method="get" action="{% url 'event-list' %}" class="mb-4">
            <input 
                type="text" name="search" placeholder="Search events..." 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-300"
            >
        </form>

        <h2 class="text-xl font-semibold text-gray-800 mb-4">Available Events</h2>

        {% for e in other_events %}
            <a href="{% url 'event-detail' e.id %}" class="block mb-4 p-4 rounded-xl bg-white shadow hover:bg-pink-50 transition space-y-1">
                <h3 class="text-lg font-semibold text-pink-700">{{ e.title }}</h3>
                <p class="text-sm text-gray-600">
                    Start: 📅 {{ e.start_time|date:"M d, Y" }} &middot; 🕒 {{ e.start_time|date:"H:i" }}
                </p>
                <p class="text-sm text-gray-500 truncate">
                    📍 {{ e.venue.name }}
                </p>
                <p class="text-xs text-gray-500 italic truncate">
                    {{ e.description|truncatechars:60 }}
                </p>
            </a>
            {% empty %}
            <p class="text-gray-500">No events found.</p>
        {% endfor %}
    </aside>

    <!-- Main Content: Event Details -->
    <main class="w-full md:w-2/3 bg-white rounded-2xl shadow-md p-6">
        
        <!-- Event Image -->
        {% if event.image %}
            <img src="{{ event.image.url }}" alt="{{ event.title }}" 
                 class="w-full h-64 object-cover rounded-xl mb-6 shadow">
        {% endif %}

        <!-- Event Details -->
        <h1 class="text-3xl font-bold text-pink-600 mb-3">{{ event.title }}</h1>

        <div class="space-y-2 text-gray-600">
            <p><strong>Start Time:</strong> {{ event.start_time }}</p>
            <p><strong>End Time:</strong> {{ event.end_time }}</p>
            <p><strong>Location:</strong> {{ event.venue.name }}, {{ event.venue.location }}</p>
        </div>

        <div class="mt-5 text-gray-700 leading-relaxed">
            <strong>Description:</strong>
            <p>{{ event.description }}</p>
        </div>

        <!-- Event Status -->
        <div class="mt-4">
            <p class="text-sm text-gray-700">
                <strong>Status:</strong>
                <span class="
                    inline-block px-3 py-1 rounded-full text-xs font-semibold
                    {% if status == 'Not started' %}
                        bg-yellow-100 text-yellow-800
                    {% elif status == 'Ongoing' %}
                        bg-green-100 text-green-800
                    {% else %}
                        bg-red-100 text-red-800
                    {% endif %}
                ">
                    {{ status }}
                </span>
            </p>
        </div>

        <!-- Ticket Info -->
        <div class="mt-6">
            {% if ticket %}
                <p class="text-red-600 font-semibold mb-4">
                    🎟️ Tickets Remaining: {{ remaining }}
                </p>

                {% if allow_purchase %}
                    {% if user.is_authenticated %}
                        <a href="{% url 'book-event' event.id %}"
                           class="inline-block bg-pink-600 text-white px-6 py-2 rounded-lg hover:bg-pink-700 transition duration-200">
                            Book Now
                        </a>
                    {% else %}
                        <p class="text-blue-600 mt-2">
                            <a href="{% url 'login' %}" class="underline font-medium">Log in</a> to book tickets.
                        </p>
                    {% endif %}
                {% else %}
                    <p class="text-red-600 font-semibold">
                        ❌ Ticket sales are closed — this event is {{ status|lower }}.
                    </p>
                {% endif %}
            {% else %}
                <p class="text-red-600 font-semibold">
                    ❌ No tickets available for this event.
                </p>
            {% endif %}
        </div>
    </main>
</div>
{% endblock %}
